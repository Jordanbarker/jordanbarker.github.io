<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Predictions for the RAGBRAI Guess the Route contest.">
    <meta name="keywords" content="RAGBRAI, Guess the Route contest, cycling, Iowa, bike ride, contest, data science, analytics">
    <meta name="author" content="Jordan Barker">
    <title>RAGBRAI Guess the Route Contest</title>
</head>

<body>
    <header>
        <h1>RAGBRAI Guess the Route Contest</h1>
        <p>RAGBRAI (Register's Annual Great Bicycle Ride Across Iowa) is a week-long cycling event that spans the state of Iowa from west to east, 
            starting at the Missouri River (or the Big Sioux River if it starts north of Sioux City) and ending at the Mississippi River. 
            Established in 1973, it is the oldest, largest, and longest recreational bicycle touring event in the world, 
            drawing thousands of participants each year to experience Iowa's small towns, scenic landscapes, and local culture.
        </p>
        <p>
            Each year, a contest is held to guess the route prior to the announcement part. 
            Applicants submit their predictions for the eight overnight towns. 
            The prizes are small, winners get some merch and <b>bragging rights.</b></p>
        <p>
        </p>
    </header>
    <nav>
        <ul>
            <li><a href="#about-contest">About the Contest</a></li>
            <li><a href="#RAGBRAI-LII">RAGBRAI LII Details</a></li>
            <li><a href="#past-routes">Past Routes</a></li>
        </ul>
    </nav>
    <main>
        <section id="RAGBRAI-LII">
            <h2>RAGBRAI LII Details</h2>
            <p>
                Honor Flight Network has been announces to be the Community Fund recipient for RAGBRAI LII. 
                This might influence the route as Honor Flight has 
                <a href="https://www.honorflight.org/hub-by-county/" target="_blank">several hubs</a>
                in Iowa cities:
            </p>
            <ul>
                <li>Fort Dodge</li>
                <li>Cedar Rapids</li>
                <li>Waterloo</li>
                <li>Davenport</li>
                <li>Dubuque</li>
            </ul>
            <p>
                Davenport and Dubuque are past ending town, but Davenport was visited just two years ago in 2023, 
                so it's unlikely to be revisited so soon. 
                That leaves Dubuque as the prime candidate.
            </p>
            <p>
                They have also released the logo, 
                which may or may not hint at the route with the dotted line in the background.
            </p>
        </section>
        <section id="past-routes">
            <h2>Past Routes Analysis</h2>
            <p>
                A great way to predict the future is to understand the past decisions made by the route planning team. 
                To do this, I scraped past route data from <a href="https://ragbrai.com/routemaps/past-overnight-towns-grid/" target="_blank">RAGBRAI's website</a>.
            </p>
            <p>
                Understanding which towns have been repeatedly visited or newly included offers valuable insights into the planning patterns for future routes.
            </p>
            <p>
                RAGBRAI had it's 50th anniversary in 2023. 
                Given that there is a limited pool of towns to visit, 
                the majority of towns have already been visited, 
                especially the start and end towns. 
                In the last 15 years, only two of those years featured new starting towns that had not been visited before and no new ending towns were chosen. 
                There are many more potential towns to choose from in the middle of route. 
                For example, 30 of the towns visited on Wednesday have been unique.
            </p>
            <p>
                Below is a scatterplot that shows the past 14 starting towns where we can see the number of years since the town was last visited on the x-axis and the total number of times the town has been visited on the y-axis. 
                The median number of years since last visited is eight.
            </p>
            <img src=".jpg" alt="placeholder">
            <p>
                Dubuque has been the ending town four times before. It's central location makes it accesible from nearly any starting point.
            </p>
            <img src=".jpg" alt="placeholder">

            <h3>Outlier Routes</h3>
            <p>While digging into the data behind RAGBRAI routes, some routes naturally popped up as unique and warrented further investigation.</p>
            
            <h4>RAGBRAI 1973</h4>
            <p>
                The first ride across Iowa, finishing on a Friday instead of Saturday which made the rides significantly longer each day. Given its unique schedule and mileage, this route was excluded from the analyses to keep consistency with newer routes.
            </p>

            <h4>RAGBRAI 2019</h4>
            <p>
                Initially, I assumed that each day's route would move eastward, but the 2019 route proved this wasn't always the case. 
                In 2019, RAGBRAI went to Burlington and then Keokuk, effectively backtracking 0.278 degrees west.
            </p>
            <p><a href="https://www.desmoinesregister.com/story/news/2022/07/19/ragbrai-route-maps-downloadable-2022-distance-towns-parking-entertainment/10062082002/" target="_blank">Route from desmoinesregister.com</a>.</p>
            
            <h4>RAGBRAI 2022</h4>
            <p>
                The 2022 route included a significant 105-mile ride from Emmetsburg, as a tribute to RAGBRAI co-founder John Karras. 
                This route also had riders backtrack from Pocahontas to Emmetsburg.
            </p>
        </section>
        <section id="finding-routes">
            <h2>Finding Possible Routes</h2>
            I used the past routes analysis to make requirements for finding possible routes. 

            <ul>
                <li>Distance between towns must be between 15 and 85 miles. 
                    The distance is calculated using the 
                    <a href="https://en.wikipedia.org/wiki/Haversine_formula" target="_blank">haversine formula</a>.</li>
                <li>Town population must be greater than 3,000. 
                    Based on the past five years of RAGBRAI routes, 
                    I found that towns with a population of over 3,000 accounted for 87.5% of overnight stops, 
                    making this a reasonable lower bound for selecting host towns.</li>
                <li>Longitude must be within the bounds of the historic minimum and maximums.</li>
                <li>Longitude change must be between (-0.087, 1.594).</li>
                <li>Latitude change must be between (-0.945, 0.811).</li>
            </ul>
        </section>
        <section id="scoring">
            <h2>Scoring and Ranking Routes</h2>
            <p>
                The likelihood of a town being chosen to start the route is defined by two criteria:
            </p>
            <ol>
                <li>How many times has the town been used as the start in the past.</li>
                <li>How many years has it been since the town was last visited.</li>
            </ol>
            <p>
                To narrow down the list of possible routes, 
                I created a scoring system that balances the frequency of a town's past visits with the time elapsed since its last inclusion. 
                The logic is simple: towns frequently chosen as stops are more likely to appear again, 
                while towns not visited for many years have a higher chance of reappearing. 
                This system naturally excludes towns visited in the previous year (score of zero) and gives less importance towns that were rarely visited, even if they were visited long ago.
            </p>
            <p>
                The score for a town on a given day is calculated as the product of two factors: 
                    (1) the town's total visit count raised to the power of 1.5 to give more weight to frequently visited towns, and 
                    (2) the number of years since its last visit. This weighting ensures that both frequency and recency are accounted for in predicting its likelihood of being chosen.
            </p>
            <p>
                Town scores are calculated using the formula:
            </p>
            <p>
                Here, <b>Visit Count</b> refers to the number of times a town has hosted an overnight stop, and 
                <b>Years Since Last Visit</b> indicates how long it has been since the town was last part of the route.
            </p>
            <p>
                The scatterplot below visualizes how towns are scored based.
            </p>
                <ul>
                    <li>The left plot shows how scores change with visit frequency and recency.</li>
                    <li>The right plot visualizes how these scores play out look on real towns.</li>
                </ul>
            <p>
                The total route score, calculated as the sum of town scores across all seven days, 
                helps prioritize routes that align with historical patterns while accommodating RAGBRAI's preference for variety.
            </p>
            <p>
                By scoring and summing up towns in this way, 
                I can rank potential routes based on their alignment with historical trends and likelihood of selection.
            </p>
        </section>
        <section id="Appendix">
            <h2>Appendix</h2>
            This section details some of the work that went into earlier versions of the project, 
            but didn't get used in the final product.
            <h3>Graph Approach</h3>
            <p>
                A more robust method of finding routes would involve the use of graph theory similar to how Google Maps helps you get from point A to B. 
            </p>
            <p>
                I downloaded graph data from OpenStreetMap using OSMnx. A graph is composed of nodes and Edges. 
                Nodes are points on the map such as towns or road intersections. 
                Edges are the connections between nodes, representing the road segments. 
                Each edge contains additional metadata, such as road type, and length.
            </p>
            <h4>Custom Path Weights</h4>
            <p>
                Not all roads are equal when planning a RAGBRAI route. To account for this, I added custom weights to the edges in my graph.
            </p>
            <p>Roads are classified by their <a href="https://wiki.openstreetmap.org/wiki/Key:highway" target="_blank">highway type</a>, 
                and I assigned the following penalties to discourage paths on busier roads:
            </p>
            <h4>Paths Between Towns</h4>
            <p>
                Finding the path between overnight towns is a computationally expensive task. 
                To reduce the number of possible paths to explore, 
                I narrowed down the list of towns based on some heuristics gathered from past routes.
            </p>
            <p>
                For example starting in Sioux Center, 
                we would narrow down the list of towns to those which are within historic limits of latitude and longitude traveled in a day as well as the haversine distance between the center of the towns. 
                This gets us a list of 20 candidate towns. 
                We can then calculate a path from Sioux Center to each candidate town to see if the path is greater than 35 miles and less than 85 miles.
            </p>
            <h4>Computational Challenges and Pivot</h4>
            <p>
                I kicked off the program and let it run overnight to find all possible routes with the starting point of Sioux Center. 
                After a full day of running, I only had routes for the first few days. 
                The issue was a combinatorial explosion in possible routes.
            </p>
            <p>
                After a several iterations of code optimization, it was still taking way too long to run. 
                I estimated it would take over a year to finish at this rate. 
                Below is an image of the 30k routes generated and I only made it to Tuesday.
            </p>
            <p>
                So I pivoted. I didn't really care to find all possible routes, but rather the most likely ones. 
                To find those, I increased the route requirements significantly. 
                This way, I still capture the majority of routes, and I can more readily interpret the results.
            </p>
            <h3>Route Clustering</h3>
        </section>
        <section id="data-and-tools">
            <h2>Data and Tools</h2>
            <p>
                Huge thank you to the following resource providers for making this project possible:
            </p>
            <ul>
                <li><a href="https://www.naturalearthdata.com/downloads/110m-cultural-vectors/110m-admin-1-states-provinces/" target="_blank">Natural Earth</a> 
                    has boundary files for Iowa available to download for free.</li>
                <li><a href="https://osmnx.readthedocs.io/en/stable/" target="_blank">OSMnx</a> 
                    offers a great interface for pulling map data from OpenStreetMap. 
                    One line of code was all it takes to get the roads and cities in Iowa saved as a graph form: G = ox.graph_from_place("Iowa", network_type="drive"). 
                </li>
                <li>The Python package <a href="https://pypi.org/project/wptools/" target="_blank">wptools</a> 
                    made pulling wikipedia information automatically. I pulled the population information and county for each town in the dataset.</li>
            </ul>
    </main>
    <footer>
        <p>
            My code repository can be found on <a href="https://github.com/Jordanbarker/RAGBRAI-Guess-The-Route" target="_blank">GitHub</a>.
        </p>
    </footer>

</body>
</html>